<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¾å ´æ—¥å ±ãƒ»30ç§’å¤‰æ›ãã‚“</title>
    <style>
        /* --- åŸºæœ¬è¨­å®š (Mobile First) --- */
        :root {
            --primary: #2563EB; /* ä¿¡é ¼ã®ãƒ–ãƒ«ãƒ¼ */
            --accent: #F59E0B;  /* æ³¨æ„å–šèµ·ã®ã‚ªãƒ¬ãƒ³ã‚¸ */
            --bg: #F3F4F6;
            --card: #FFFFFF;
            --text: #1F2937;
            --gray: #6B7280;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: var(--card);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
        }

        /* --- ãƒ˜ãƒƒãƒ€ãƒ¼ --- */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        h1 { margin: 0; font-size: 1.2rem; font-weight: bold; }
        p.subtitle { margin: 0; font-size: 0.8rem; opacity: 0.9; }

        /* --- æ¥­ç¨®é¸æŠã‚¿ãƒ– --- */
        .tabs {
            display: flex;
            border-bottom: 1px solid #E5E7EB;
            background: #fff;
            overflow-x: auto; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ */
        }
        .tab-btn {
            flex: 1;
            padding: 12px 5px;
            border: none;
            background: none;
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--gray);
            cursor: pointer;
            white-space: nowrap;
            transition: 0.2s;
            border-bottom: 3px solid transparent;
        }
        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* --- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ --- */
        main { padding: 20px; flex: 1; }

        .label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 5px;
            display: block;
            font-weight: bold;
        }

        textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-size: 1rem;
            resize: none;
            box-sizing: border-box;
            background-color: #FAFAFA;
            transition: 0.2s;
        }
        textarea:focus {
            border-color: var(--primary);
            outline: none;
            background-color: #fff;
        }

        /* --- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ --- */
        .action-area {
            margin-top: 15px;
            text-align: center;
        }
        .convert-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3);
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .convert-btn:active { transform: scale(0.98); }
        .convert-btn:disabled { background-color: var(--gray); cursor: not-allowed; }

        /* --- AIæ€è€ƒä¸­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ --- */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95);
            z-index: 50;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid #E5E7EB;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text);
        }
        .loading-sub {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 5px;
        }

        /* --- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ --- */
        #result-area {
            display: none;
            margin-top: 30px;
            border-top: 1px solid #E5E7EB;
            padding-top: 20px;
            animation: slideUp 0.4s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .result-box {
            background-color: #F0F9FF;
            border: 1px solid #BAE6FD;
            border-radius: 8px;
            padding: 15px;
            font-size: 0.95rem;
            white-space: pre-wrap; /* æ”¹è¡Œã‚’ä¿æŒ */
            color: #0C4A6E;
            margin-bottom: 10px;
            position: relative;
        }
        
        .copy-btn {
            background-color: #fff;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 5px;
            display: inline-block;
        }
        .copy-btn.copied {
            background-color: var(--primary);
            color: white;
        }

        /* --- ãƒ•ãƒƒã‚¿ãƒ¼ã¨è¨­å®š --- */
        footer {
            margin-top: auto;
            padding: 20px;
            text-align: center;
            font-size: 0.8rem;
            color: #9CA3AF;
            border-top: 1px solid #E5E7EB;
        }
        .settings-toggle { cursor: pointer; text-decoration: underline; }
        
        #settings-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
        }
        .api-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
        .save-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        .close-btn {
            background: #ccc;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ç¾å ´æ—¥å ±ãƒ»30ç§’å¤‰æ›ãã‚“</h1>
        <p class="subtitle">æ®´ã‚Šæ›¸ããƒ¡ãƒ¢ã‚’ã€ä¸€ç¬ã§ã€Œå ±å‘Šæ›¸ã€ã¸</p>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('construction')">ğŸ—ï¸ å»ºè¨­ãƒ»å·¥äº‹</button>
        <button class="tab-btn" onclick="switchTab('care')">ğŸ‘´ ä»‹è­·ãƒ»ç¦ç¥‰</button>
        <button class="tab-btn" onclick="switchTab('logistics')">ğŸšš ç‰©æµãƒ»é…é€</button>
    </div>

    <main>
        <label class="label">ç¾å ´ã®ãƒ¡ãƒ¢ã‚’å…¥åŠ›ï¼ˆéŸ³å£°å…¥åŠ›ã‚‚OKï¼‰</label>
        <textarea id="input-text" placeholder="ä¾‹ï¼šé›¨ã§ä¸­æ­¢ã€‚Aå·¥åŒºå®Œäº†ã€‚Bå·¥åŒºã¯è³‡æå¾…ã¡ã€‚éˆ´æœ¨ã•ã‚“ãŒæ€ªæˆ‘ãªã—ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆã€‚"></textarea>
        
        <div style="text-align: right; margin-top: 5px;">
            <small style="color: var(--gray);">â€»ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰: å†…å®¹ã¯å›ºå®šå‡ºåŠ›ã•ã‚Œã¾ã™</small>
        </div>

        <div class="action-area">
            <button class="convert-btn" onclick="generateReport()">
                <span>âš¡ æ—¥å ±ã«å¤‰æ›ã™ã‚‹</span>
            </button>
        </div>

        <div id="result-area">
            <label class="label">âœ… ç”Ÿæˆã•ã‚ŒãŸæ—¥å ±ï¼ˆãã®ã¾ã¾é€ã‚Œã¾ã™ï¼‰</label>
            <div class="result-box" id="output-text">ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™...</div>
            <button class="copy-btn" onclick="copyResult(this)">ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹</button>
        </div>
    </main>

    <footer>
        <p>Generated by AI Support Tool</p>
        <p><span class="settings-toggle" onclick="toggleSettings()">âš™ï¸ è¨­å®š (API Key)</span></p>
    </footer>
</div>

<div class="loading-overlay" id="loading-overlay">
    <div class="spinner"></div>
    <div class="loading-text" id="loading-main-text">AIãŒæ€è€ƒä¸­...</div>
    <div class="loading-sub" id="loading-sub-text">å†…å®¹ã‚’è§£æã—ã¦ã„ã¾ã™</div>
</div>

<div id="settings-modal">
    <div class="modal-content">
        <h3>è¨­å®š</h3>
        <p>OpenAI API Keyã‚’å…¥åŠ›ã™ã‚‹ã¨ã€å®Ÿéš›ã«è‡ªç”±ãªå…¥åŠ›ã§å¤‰æ›ã§ãã¾ã™ã€‚ï¼ˆã‚­ãƒ¼ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ï¼‰</p>
        <input type="password" id="api-key-input" class="api-input" placeholder="sk-...">
        <div style="text-align: right;">
            <button class="save-btn" onclick="saveApiKey()">ä¿å­˜</button>
            <button class="close-btn" onclick="toggleSettings()">é–‰ã˜ã‚‹</button>
        </div>
        <p id="key-status" style="font-size: 0.8rem; margin-top: 10px;"></p>
    </div>
</div>

<script>
    // --- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰ ---
    // ã“ã“ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã€ŒAPIã‚­ãƒ¼ãŒãªã„å ´åˆã€ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
    // ã©ã‚“ãªå…¥åŠ›ã‚’ã—ã¦ã‚‚ã€ã“ã®ã€Œæ­£è§£ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ä»•çµ„ã¿ã§ã€ãƒ‡ãƒ¢ã®æˆåŠŸç‡ã‚’100%ã«ã—ã¾ã™ã€‚
    const demoData = {
        construction: {
            placeholder: "ä¾‹ï¼šé›¨ã§ä¸­æ­¢ãªã‚Šãã†ã ã£ãŸã‘ã©ã‚„ã£ãŸã€‚Aå·¥åŒºã¯ãŠã‚ã‚Šã€‚Bã¯è³‡æã“ãªã„ã‹ã‚‰ç„¡ç†ã€‚éˆ´æœ¨ã•ã‚“ãŒè¶³å ´ã«é ­ã¶ã¤ã‘ãŸã€‚ã‚±ã‚¬ãªã—ã€‚æ˜æ—¥ã¯8æ™‚ã€‚",
            input: "é›¨ã§ä¸­æ­¢ãªã‚Šãã†ã ã£ãŸã‘ã©ã‚„ã£ãŸã€‚Aå·¥åŒºã¯ãŠã‚ã‚Šã€‚Bã¯è³‡æã“ãªã„ã‹ã‚‰ç„¡ç†ã€‚éˆ´æœ¨ã•ã‚“ãŒè¶³å ´ã«é ­ã¶ã¤ã‘ãŸã€‚ã‚±ã‚¬ãªã—ã€‚æ˜æ—¥ã¯8æ™‚ã€‚",
            output: `ã€æ¥­å‹™æ—¥å ±ã€‘
æ—¥æ™‚ï¼š202Xå¹´XæœˆXæ—¥
å ±å‘Šè€…ï¼š[æ°å]

1. æ¥­å‹™é€²æ—
âœ… Aå·¥åŒºï¼šä½œæ¥­å®Œäº†ã€‚
âš ï¸ Bå·¥åŒºï¼šè³‡æç´å“é…å»¶ã®ãŸã‚æœªç€æ‰‹ã€‚æ˜æ—¥ã¸ç¹°ã‚Šè¶Šã—ã€‚
â€»å¤©å€™ä¸é †ï¼ˆé›¨å¤©ï¼‰ã§ã—ãŸãŒã€äºˆå®šé€šã‚Šæ±ºè¡Œã„ãŸã—ã¾ã—ãŸã€‚

2. ç‰¹è¨˜äº‹é …ãƒ»å®‰å…¨ç®¡ç†
âš ï¸ ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆå ±å‘Š
ãƒ»çŠ¶æ³ï¼šéˆ´æœ¨æ°ãŒè¶³å ´ã«ã¦é ­éƒ¨ã‚’æ¥è§¦ã€‚
ãƒ»çµæœï¼šè² å‚·ãªã—ã€‚
ãƒ»å¯¾ç­–ï¼šç¾å ´å†…ã§ã®æ³¨æ„å–šèµ·ã‚’å†å¾¹åº•æ¸ˆã¿ã€‚

3. æ˜æ—¥ã®äºˆå®š
ãƒ»é›†åˆï¼š8:00
ãƒ»å„ªå…ˆï¼šBå·¥åŒºã®é…ã‚ŒæŒ½å›`
        },
        care: {
            placeholder: "ä¾‹ï¼šç”°ä¸­ã•ã‚“ã€å…¥æµ´æ‹’å¦ã€‚æš´è¨€ã‚ã‚Šã€‚ãªã‚“ã¨ã‹èª¬å¾—ã—ã¦å…¥ã£ãŸã‘ã©èƒŒä¸­ã«ã‚ã–ç™ºè¦‹ã€‚çœ‹è­·å¸«ã«å ±å‘Šæ¸ˆã¿ã€‚ã‚ã¨å®¶æ—ã‹ã‚‰æ´—æ¿¯ç‰©ã®ä»¶ã§ã‚¯ãƒ¬ãƒ¼ãƒ é›»è©±ã‚ã£ãŸã€‚",
            input: "ç”°ä¸­ã•ã‚“ã€å…¥æµ´æ‹’å¦ã€‚æš´è¨€ã‚ã‚Šã€‚ãªã‚“ã¨ã‹èª¬å¾—ã—ã¦å…¥ã£ãŸã‘ã©èƒŒä¸­ã«ã‚ã–ç™ºè¦‹ã€‚çœ‹è­·å¸«ã«å ±å‘Šæ¸ˆã¿ã€‚ã‚ã¨å®¶æ—ã‹ã‚‰æ´—æ¿¯ç‰©ã®ä»¶ã§ã‚¯ãƒ¬ãƒ¼ãƒ é›»è©±ã‚ã£ãŸã€‚",
            output: `ã€ä»‹è­·æ¥­å‹™æ—¥èªŒã€‘
åˆ©ç”¨è€…æ§˜ï¼šç”°ä¸­æ§˜

1. åˆ©ç”¨è€…çŠ¶æ³ï¼ˆå…¥æµ´ä»‹åŠ©ï¼‰
âš ï¸ å…¥æµ´æ™‚ã«å¼·ã„æ‹’å¦ãŠã‚ˆã³æš´è¨€ç­‰ã®ä¸ç©è¡Œå‹•ã‚ã‚Šã€‚
ãƒ»å¯¾å¿œï¼šèª¬å¾—ã«ã‚ˆã‚Šå…¥æµ´å®Ÿæ–½ã€‚
ãƒ»ç‰¹è¨˜ï¼šèƒŒéƒ¨ã«ã€Œã‚ã–ã€ã‚’ç™ºè¦‹ã€‚çœ‹è­·å¸«ã¸å ±å‘Šãƒ»å…±æœ‰æ¸ˆã¿ã€‚

2. ã”å®¶æ—å¯¾å¿œ
ğŸ“ æ´—æ¿¯ç‰©ã«é–¢ã™ã‚‹ã”æ„è¦‹ï¼ˆã‚¯ãƒ¬ãƒ¼ãƒ ï¼‰ã‚’å—é›»ã€‚
ãƒ»å†…å®¹ã®ç¢ºèªã¨å¯¾å¿œã‚’è¡Œã£ã¦ãŠã‚Šã¾ã™ã€‚

3. ç”³ã—é€ã‚Šäº‹é …
ãƒ»å…¥æµ´æ™‚ã®çš®è†šè¦³å¯Ÿï¼ˆã‚ã–ã®çµŒéï¼‰ã®ç¶™ç¶šã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚`
        },
        logistics: {
            placeholder: "ä¾‹ï¼šé¦–éƒ½é«˜äº‹æ•…ã§æ¸‹æ»ã€åˆå‰æŒ‡å®šã®2ä»¶ã¾ã«ã‚ã‚ãšã€‚åˆå¾Œã«å›ã—ãŸã€‚ä¸åœ¨å¤šã™ãã€å†é…é”ã§æ®‹æ¥­ç¢ºå®šã€‚ãƒˆãƒ©ãƒƒã‚¯ã®ãƒ–ãƒ¬ãƒ¼ã‚­éŸ³ãŠã‹ã—ã„æ°—ãŒã™ã‚‹ã€‚",
            input: "é¦–éƒ½é«˜äº‹æ•…ã§æ¸‹æ»ã€åˆå‰æŒ‡å®šã®2ä»¶ã¾ã«ã‚ã‚ãšã€‚åˆå¾Œã«å›ã—ãŸã€‚ä¸åœ¨å¤šã™ãã€å†é…é”ã§æ®‹æ¥­ç¢ºå®šã€‚ãƒˆãƒ©ãƒƒã‚¯ã®ãƒ–ãƒ¬ãƒ¼ã‚­éŸ³ãŠã‹ã—ã„æ°—ãŒã™ã‚‹ã€‚",
            output: `ã€é…é€æ¥­å‹™å ±å‘Šã€‘

1. é…é€çŠ¶æ³
âš ï¸ é…å»¶ç™ºç”Ÿï¼šé¦–éƒ½é«˜äº‹æ•…æ¸‹æ»ã®å½±éŸ¿ã«ã‚ˆã‚Šã€åˆå‰æŒ‡å®š2ä»¶æœªé”ã€‚åˆå¾Œä¾¿ã¸æŒ¯æ›¿å¯¾å¿œæ¸ˆã¿ã€‚
âš ï¸ å†é…é”å¤šç™ºï¼šä¸åœ¨ã«ã‚ˆã‚‹æŒã¡æˆ»ã‚ŠãŒå¢—åŠ ã—ã¦ãŠã‚Šã€å†é…é”å¯¾å¿œã®ãŸã‚æ®‹æ¥­ãŒç™ºç”Ÿã„ãŸã—ã¾ã™ã€‚

2. è»Šä¸¡ç®¡ç†
âš ï¸ è»Šä¸¡ä¸èª¿ã®æ‡¸å¿µ
ãƒ»ç—‡çŠ¶ï¼šãƒ–ãƒ¬ãƒ¼ã‚­æ“ä½œæ™‚ã«ç•°éŸ³ã‚’ç¢ºèªã€‚
ãƒ»å¯¾å¿œä¾é ¼ï¼šæ—©æ€¥ãªæ•´å‚™ç‚¹æ¤œã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚

3. ãã®ä»–
ãƒ»æ˜æ—¥ã®ãƒ«ãƒ¼ãƒˆç¢ºèªæ¸ˆã¿ã€‚å®‰å…¨é‹è»¢ã§å¸°åº«ã—ã¾ã™ã€‚`
        }
    };

    let currentMode = 'construction';

    // --- åˆæœŸåŒ– ---
    window.onload = function() {
        switchTab('construction');
        checkApiKey();
    };

    // --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ---
    function switchTab(mode) {
        currentMode = mode;
        // ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®æ›´æ–°
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // å…¥åŠ›ã‚¨ãƒªã‚¢ã®ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ¢ç”¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚»ãƒƒãƒˆï¼‰
        const textInput = document.getElementById('input-text');
        textInput.value = demoData[mode].input;
        textInput.placeholder = demoData[mode].placeholder;
        
        // çµæœã‚¨ãƒªã‚¢ã‚’éš ã™
        document.getElementById('result-area').style.display = 'none';
    }

    // --- ç”Ÿæˆå‡¦ç†ã®ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ ---
    async function generateReport() {
        const inputText = document.getElementById('input-text').value;
        if (!inputText) return alert("ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

        // UI: ãƒ­ãƒ¼ãƒ‰ç”»é¢è¡¨ç¤º
        const overlay = document.getElementById('loading-overlay');
        const mainText = document.getElementById('loading-main-text');
        const subText = document.getElementById('loading-sub-text');
        
        overlay.style.display = 'flex';
        
        // æ¼”å‡º: ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ»ã€…ã¨å¤‰ãˆã‚‹ï¼ˆAIãŒè€ƒãˆã¦ã„ã‚‹æ„Ÿï¼‰
        const steps = [
            { t: "AIãŒæ€è€ƒä¸­...", s: "å…¥åŠ›ã•ã‚ŒãŸãƒ¡ãƒ¢ã‚’è§£æã—ã¦ã„ã¾ã™" },
            { t: "æ§‹é€ åŒ–ä¸­...", s: "äº‹å®Ÿé–¢ä¿‚ã¨æ„Ÿæƒ…ã‚’æ•´ç†ã—ã¦ã„ã¾ã™" },
            { t: "ç¿»è¨³ä¸­...", s: "ãƒ“ã‚¸ãƒã‚¹ç”¨èªã«å¤‰æ›ã—ã¦ã„ã¾ã™" },
            { t: "æœ€çµ‚èª¿æ•´ä¸­...", s: "èª­ã¿ã‚„ã™ã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ•´ãˆã¦ã„ã¾ã™" }
        ];

        let stepIndex = 0;
        const interval = setInterval(() => {
            stepIndex++;
            if (stepIndex < steps.length) {
                mainText.innerText = steps[stepIndex].t;
                subText.innerText = steps[stepIndex].s;
            }
        }, 800);

        try {
            const apiKey = localStorage.getItem('openai_api_key');
            let resultText = "";

            if (apiKey && apiKey.startsWith('sk-')) {
                // === Real Mode (API Call) ===
                resultText = await callOpenAI(inputText, apiKey);
            } else {
                // === Demo Mode (Fake) ===
                // 3ç§’å¾…ã¤ã ã‘ï¼ˆæ¼”å‡ºã®ãŸã‚ï¼‰
                await new Promise(resolve => setTimeout(resolve, 3000));
                resultText = demoData[currentMode].output;
            }

            // å®Œäº†å‡¦ç†
            clearInterval(interval);
            overlay.style.display = 'none';
            
            const outputBox = document.getElementById('output-text');
            outputBox.innerText = resultText;
            document.getElementById('result-area').style.display = 'block';

            // çµæœã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });

        } catch (error) {
            clearInterval(interval);
            overlay.style.display = 'none';
            alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
        }
    }

    // --- OpenAI APIå‘¼ã³å‡ºã—é–¢æ•° ---
    async function callOpenAI(input, key) {
        const systemPrompt = `
Role: ã‚ãªãŸã¯ã€Œç¾å ´ã®çŠ¶æ³ã‚’èª°ã‚ˆã‚Šã‚‚ç†è§£ã—ã¦ã„ã‚‹ç†Ÿç·´ã®ç¾å ´ãƒªãƒ¼ãƒ€ãƒ¼ã€ã§ã™ã€‚
Input: ç¾å ´ä½œæ¥­å“¡ã‹ã‚‰ã®ã€Œé›‘ãªãƒ¡ãƒ¢ã€ã€Œå˜èªã®ç¾…åˆ—ã€ã€Œæ„Ÿæƒ…çš„ãªæ„šç—´ã€ãŒå…¥åŠ›ã•ã‚Œã¾ã™ã€‚
Output: ã“ã‚Œã‚’ã€ç¤¾é•·ã‚„ç®¡ç†è€…ãŒä¸€ç›®ã§çŠ¶æ³ã‚’æŠŠæ¡ã§ãã‚‹ã€Œæ¥­å‹™æ—¥å ±ã€ã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚

ã€å¤‰æ›ãƒ«ãƒ¼ãƒ«ã€‘
1. æ–‡ä½“:
   - éå‰°ãªæ•¬èªã¯ç¦æ­¢ã€‚ã€Œã€œã§ã™ãƒ»ã¾ã™ã€ã¾ãŸã¯ã€Œã€œã ãƒ»ã§ã‚ã‚‹ã€ã®ç°¡æ½”ãªå ±å‘Šèª¿ã«ã™ã‚‹ã€‚
   - ä¸»è¦³çš„è¡¨ç¾ï¼ˆã€œã¨æ€ã„ã¾ã™ï¼‰ã¯ã€å®¢è¦³çš„äº‹å®Ÿï¼ˆã€œã®æ‡¸å¿µã‚ã‚Šï¼‰ã«æ›¸ãæ›ãˆã‚‹ã€‚

2. æ§‹é€ åŒ–ï¼ˆå¿…é ˆï¼‰:
   ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å¼·åˆ¶çš„ã«åˆ†é¡ã—ã¦å‡ºåŠ›ã™ã‚‹ã“ã¨ã€‚
   - ã€æ¥­å‹™é€²æ—ã€‘: ä½•ãŒçµ‚ã‚ã‚Šã€ä½•ãŒçµ‚ã‚ã£ã¦ã„ãªã„ã‹ã€‚
   - ã€ç‰¹è¨˜äº‹é …ã€‘: ãƒˆãƒ©ãƒ–ãƒ«ã€ã‚¯ãƒ¬ãƒ¼ãƒ ã€ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆã€æ©Ÿæä¸èª¿ã€‚â€»æœ€é‡è¦
   - ã€æ˜æ—¥ã®äºˆå®š/ç”³ã—é€ã‚Šã€‘: æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚

3. é­”æ³•ã®è£œå®Œ:
   - ã€Œã¶ã¤ã‘ãŸã€â†’ã€Œæ¥è§¦äº‹æ•…/ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆã€
   - ã€ŒéŸ³ãŒãŠã‹ã—ã„ã€â†’ã€Œç•°éŸ³ç¢ºèª/ç‚¹æ¤œå¿…è¦ã€
   - ã€Œæš´è¨€ã€â†’ã€Œä¸ç©è¡Œå‹•ã‚ã‚Šã€

4. å‡ºåŠ›å½¢å¼:
   ã‚¹ãƒãƒ›ã§èª­ã¿ã‚„ã™ã„ã‚ˆã†ã€é©åº¦ãªæ”¹è¡Œã¨çµµæ–‡å­—ï¼ˆâœ…ã€âš ï¸ã€ğŸ“…ï¼‰ã‚’ç®‡æ¡æ›¸ãã«ä½¿ç”¨ã™ã‚‹ã€‚
`;

        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${key}`
            },
            body: JSON.stringify({
                model: "gpt-4o-mini", // ã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–
                messages: [
                    { role: "system", content: systemPrompt },
                    { role: "user", content: input }
                ],
                temperature: 0.7
            })
        });

        if (!response.ok) {
            const err = await response.json();
            throw new Error(err.error?.message || "API Request Failed");
        }

        const data = await response.json();
        return data.choices[0].message.content;
    }

    // --- ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ ---
    function copyResult(btn) {
        const text = document.getElementById('output-text').innerText;
        navigator.clipboard.writeText(text).then(() => {
            const originalText = btn.innerText;
            btn.innerText = "âœ¨ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
            btn.classList.add('copied');
            setTimeout(() => {
                btn.innerText = originalText;
                btn.classList.remove('copied');
            }, 2000);
        });
    }

    // --- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ ---
    function toggleSettings() {
        const modal = document.getElementById('settings-modal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
        checkApiKey();
    }

    function saveApiKey() {
        const input = document.getElementById('api-key-input');
        const key = input.value.trim();
        if (key) {
            localStorage.setItem('openai_api_key', key);
            alert("API Keyã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚å®Ÿæ©Ÿãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™ã€‚");
            toggleSettings();
        } else {
            localStorage.removeItem('openai_api_key');
            alert("API Keyã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚Šã¾ã™ã€‚");
            toggleSettings();
        }
    }

    function checkApiKey() {
        const key = localStorage.getItem('openai_api_key');
        const statusText = document.getElementById('key-status');
        if (key) {
            statusText.innerText = "âœ… API Keyè¨­å®šæ¸ˆã¿ï¼ˆå®Ÿæ©Ÿãƒ¢ãƒ¼ãƒ‰ï¼‰";
            statusText.style.color = "green";
            document.getElementById('api-key-input').value = key;
        } else {
            statusText.innerText = "â„¹ï¸ API Keyæœªè¨­å®šï¼ˆãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ï¼‰";
            statusText.style.color = "gray";
        }
    }

</script>
</body>
</html>
